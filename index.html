<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>EduSearch ‚Äî –ü–æ—à—É–∫ –æ—Å–≤—ñ—Ç–Ω—ñ—Ö –º–∞—Ç–µ—Ä—ñ–∞–ª—ñ–≤</title>
  <style>
    * {
      box-sizing: border-box;
    }

    html, body {
      height: 100%;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
      background-color: #fafafa;
      color: #222;
      line-height: 1.5;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }

    .container {
      width: 100%;
      max-width: 1000px;
      margin: 0 auto;
      padding: 0 20px 24px;
      flex: 1;
      position: relative;
      padding-top: 260px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .header {
      position: absolute;
      top: 120px;
      left: 0;
      right: 0;
      text-align: center;
      opacity: 1;
      transform: translateY(0);
      transition: opacity 0.3s ease, transform 0.3s ease;
      pointer-events: auto;
    }

    .header.hidden {
      opacity: 0;
      transform: translateY(-20px);
      pointer-events: none;
    }

    .logo {
      font-size: 32px;
      font-weight: 600;
      color: #1e6ff0;
      margin-bottom: 8px;
    }

    .subtitle {
      font-size: 16px;
      color: #666;
    }

    .search-wrapper {
      position: relative;
      margin-bottom: 24px;
      width: 100%;
      max-width: 600px;
      display: flex;
      gap: 8px;
    }

    .input-container {
      position: relative;
      flex: 1;
    }

    .search-box {
      width: 100%;
      padding: 14px 50px 14px 20px;
      font-size: 16px;
      border: 1px solid #ccc;
      border-radius: 28px;
      outline: none;
      background: #fff;
      transition: border-color 0.2s, box-shadow 0.2s;
    }

    .search-box:focus {
      border-color: #1e6ff0;
      box-shadow: 0 0 0 2px rgba(30, 111, 240, 0.15);
    }

    .voice-btn {
      position: absolute;
      right: 14px;
      top: 50%;
      transform: translateY(-50%);
      background: none;
      border: none;
      font-size: 20px;
      cursor: pointer;
      padding: 4px;
      border-radius: 50%;
      transition: background 0.2s;
    }

    .voice-btn:hover {
      background: #f0f0f0;
    }

    .voice-btn.recording {
      color: #f44336;
      animation: pulse 1s infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }

    .google-btn {
      background: #f8f9fa;
      border: 1px solid #ccc;
      border-radius: 28px;
      font-size: 14px;
      font-weight: 500;
      color: #5f6368;
      cursor: pointer;
      padding: 0 16px;
      display: flex;
      align-items: center;
      justify-content: center;
      white-space: nowrap;
      min-width: 80px;
      transition: background 0.2s, border-color 0.2s;
    }

    .google-btn:hover {
      background: #e8eaed;
      border-color: #1e6ff0;
    }

    .search-wrapper.lifted {
      transform: translateY(-140px);
      margin-bottom: -116px;
      position: relative;
    }

    /* –ù–µ–¥–∞–≤–Ω—ñ —Ç–µ–º–∏ ‚Äî –ø–ª–∞–≤–Ω–∞ –ø–æ—è–≤–∞/–∑–Ω–∏–∫–Ω–µ–Ω–Ω—è */
    .recent-section,
    .favorites-section {
      width: 100%;
      max-width: 600px;
      margin-top: 8px;
      overflow: hidden;
      opacity: 0;
      max-height: 0;
      transition: opacity 0.3s ease, max-height 0.3s ease;
    }

    .recent-section.visible,
    .favorites-section.visible {
      opacity: 1;
      max-height: 200px;
    }

    .recent-title,
    .favorites-title {
      font-size: 14px;
      font-weight: 600;
      color: #555;
      margin: 16px 0 8px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .recent-list,
    .favorites-list {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }

    .recent-item,
    .favorite-item {
      background: #eef4ff;
      padding: 6px 12px;
      border-radius: 16px;
      font-size: 13px;
      color: #1e6ff0;
      cursor: pointer;
      transition: background 0.2s;
      position: relative;
      padding-right: 24px;
    }

    .recent-item:hover,
    .favorite-item:hover {
      background: #dceaff;
    }

    /* –ö–Ω–æ–ø–∫–∏ –≤–∏–¥–∞–ª–µ–Ω–Ω—è */
    .delete-recent,
    .delete-fav {
      position: absolute;
      right: 6px;
      top: 50%;
      transform: translateY(-50%);
      font-size: 14px;
      color: #999;
      cursor: pointer;
      opacity: 0;
      transition: opacity 0.2s;
    }

    .recent-item:hover .delete-recent,
    .favorite-item:hover .delete-fav {
      opacity: 1;
    }

    .results-section,
    .calculator-result {
      margin-top: 24px;
      width: 100%;
      max-width: 600px;
      transition: opacity 0.3s ease;
    }

    .video-section,
    .result-item {
      display: none;
    }

    .video-section.visible,
    .result-item.visible {
      display: block;
      opacity: 1;
      transform: translateY(0);
      animation: fadeInUp 0.3s ease forwards;
    }

    .calculator-result {
      display: none;
      text-align: center;
      font-size: 24px;
      font-weight: bold;
      color: #1e6ff0;
      background: #f9f9ff;
      padding: 16px;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    }

    .calculator-result.visible {
      display: block;
      animation: fadeInUp 0.3s ease forwards;
    }

    .average-hint {
      font-size: 16px;
      color: #555;
      margin-top: 8px;
      font-weight: normal;
    }

    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(8px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .section-title {
      font-size: 14px;
      font-weight: 600;
      color: #555;
      margin: 16px 0 12px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .result-title {
      font-size: 18px;
      color: #1e6ff0;
      text-decoration: none;
      font-weight: 500;
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 4px;
      position: relative;
    }

    .result-title:hover {
      text-decoration: underline;
    }

    .favicon {
      width: 18px;
      height: 18px;
      flex-shrink: 0;
      border-radius: 2px;
    }

    .result-url {
      font-size: 14px;
      color: #0d6e3f;
      margin-bottom: 4px;
    }

    .result-desc {
      font-size: 14px;
      color: #666;
    }

    /* Tooltip */
    .tooltip {
      position: absolute;
      bottom: 100%;
      left: 50%;
      transform: translateX(-50%);
      background: #333;
      color: #fff;
      padding: 6px 10px;
      border-radius: 6px;
      font-size: 13px;
      white-space: nowrap;
      z-index: 1000;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.2s;
    }

    .tooltip.visible {
      opacity: 1;
    }

    /* Favorite star */
    .favorite-star {
      position: absolute;
      right: -24px;
      top: 50%;
      transform: translateY(-50%);
      font-size: 18px;
      color: #ccc;
      cursor: pointer;
      transition: color 0.2s;
    }

    .favorite-star.filled {
      color: #f4c20d;
    }

    footer {
      text-align: center;
      padding: 24px;
      border-top: 1px solid #eee;
      font-size: 14px;
      color: #666;
      background: #fff;
      margin-top: auto;
    }

    footer a {
      color: #1e6ff0;
      text-decoration: none;
    }

    footer a:hover {
      text-decoration: underline;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header" id="header">
      <div class="logo">EduSearch</div>
      <div class="subtitle">–ü–æ—à—É–∫ –æ—Å–≤—ñ—Ç–Ω—ñ—Ö –º–∞—Ç–µ—Ä—ñ–∞–ª—ñ–≤ –∑–∞ —Ç–µ–º–æ—é</div>
    </div>

    <div class="search-wrapper" id="searchWrapper">
      <div class="input-container">
        <input type="text" id="keywords" class="search-box" placeholder="–ù–∞–ø—Ä–∏–∫–ª–∞–¥: past simple, climate change... –∞–±–æ 5+3+2" autocomplete="off" />
        <button class="voice-btn" id="voiceBtn" title="–ì–æ–ª–æ—Å–æ–≤–µ –≤–≤–µ–¥–µ–Ω–Ω—è">üéôÔ∏è</button>
      </div>
      <button class="google-btn" id="googleBtn">Google</button>
    </div>

    <!-- –ù–µ–¥–∞–≤–Ω—ñ —Ç–µ–º–∏ -->
    <div class="recent-section" id="recent-section">
      <div class="recent-title">–ù–µ–¥–∞–≤–Ω—ñ —Ç–µ–º–∏</div>
      <div class="recent-list" id="recent-list"></div>
    </div>

    <!-- –£–ª—é–±–ª–µ–Ω–µ -->
    <div class="favorites-section" id="favorites-section">
      <div class="favorites-title">–£–ª—é–±–ª–µ–Ω–µ</div>
      <div class="favorites-list" id="favorites-list"></div>
    </div>

    <!-- –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä-—Ä–µ–∑—É–ª—å—Ç–∞—Ç -->
    <div class="calculator-result" id="calculatorResult"></div>

    <!-- –û—Å–Ω–æ–≤–Ω—ñ —Ä–µ—Å—É—Ä—Å–∏ -->
    <div class="results-section" id="main-results">
      <div class="result-item" id="item-wordwall">
        <a href="#" class="result-title" target="_blank" rel="noopener">
          <img class="favicon" src="https://www.google.com/s2/favicons?domain=wordwall.net" alt="">
          <span></span>
          <div class="tooltip">Wordwall ‚Äî —Å—Ç–≤–æ—Ä—é–π—Ç–µ —ñ–≥—Ä–∏ –∑–∞ 2 —Ö–≤–∏–ª–∏–Ω–∏</div>
        </a>
        <div class="result-url">wordwall.net</div>
        <div class="result-desc">–°–ø—ñ–ª—å–Ω–æ—Ç–∞ Wordwall: —ñ–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ñ –∑–∞–≤–¥–∞–Ω–Ω—è</div>
        <span class="favorite-star" data-id="wordwall">‚òÜ</span>
      </div>
      <div class="result-item" id="item-liveworksheets">
        <a href="#" class="result-title" target="_blank" rel="noopener">
          <img class="favicon" src="https://www.google.com/s2/favicons?domain=liveworksheets.com" alt="">
          <span></span>
          <div class="tooltip">Liveworksheets ‚Äî —ñ–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ñ —Ä–æ–±–æ—á—ñ –∞—Ä–∫—É—à—ñ</div>
        </a>
        <div class="result-url">liveworksheets.com</div>
        <div class="result-desc">–Ü–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ñ —Ä–æ–±–æ—á—ñ –∞—Ä–∫—É—à—ñ</div>
        <span class="favorite-star" data-id="liveworksheets">‚òÜ</span>
      </div>
      <div class="result-item" id="item-islcollective-worksheets">
        <a href="#" class="result-title" target="_blank" rel="noopener">
          <img class="favicon" src="https://www.google.com/s2/favicons?domain=islcollective.com" alt="">
          <span></span>
          <div class="tooltip">ISL Collective ‚Äî –¥—Ä—É–∫–æ–≤–∞–Ω—ñ —Ç–∞ —Ü–∏—Ñ—Ä–æ–≤—ñ –º–∞—Ç–µ—Ä—ñ–∞–ª–∏</div>
        </a>
        <div class="result-url">islcollective.com</div>
        <div class="result-desc">–î—Ä—É–∫–æ–≤–∞–Ω—ñ —Ç–∞ —Ü–∏—Ñ—Ä–æ–≤—ñ –º–∞—Ç–µ—Ä—ñ–∞–ª–∏</div>
        <span class="favorite-star" data-id="islcollectiveWorksheets">‚òÜ</span>
      </div>
      <div class="result-item" id="item-learningapps">
        <a href="#" class="result-title" target="_blank" rel="noopener">
          <img class="favicon" src="https://www.google.com/s2/favicons?domain=learningapps.org" alt="">
          <span></span>
          <div class="tooltip">LearningApps ‚Äî —ñ–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ñ –∑–∞–≤–¥–∞–Ω–Ω—è —Ç–∞ –≥—Ä–∏</div>
        </a>
        <div class="result-url">learningapps.org</div>
        <div class="result-desc">–Ü–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ñ –∑–∞–≤–¥–∞–Ω–Ω—è —Ç–∞ –≥—Ä–∏</div>
        <span class="favorite-star" data-id="learningapps">‚òÜ</span>
      </div>
      <div class="result-item" id="item-naurok-presentations">
        <a href="#" class="result-title" target="_blank" rel="noopener">
          <img class="favicon" src="https://www.google.com/s2/favicons?domain=naurok.com.ua" alt="">
          <span></span>
          <div class="tooltip">–ù–∞ –£—Ä–æ–∫ ‚Äî –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü—ñ—ó</div>
        </a>
        <div class="result-url">naurok.com.ua (–ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü—ñ—ó)</div>
        <div class="result-desc">–ü—Ä–µ–∑–µ–Ω—Ç–∞—Ü—ñ—ó –Ω–∞ ¬´–ù–∞ –£—Ä–æ–∫¬ª</div>
        <span class="favorite-star" data-id="naurokPresentations">‚òÜ</span>
      </div>
      <div class="result-item" id="item-naurok-tests">
        <a href="#" class="result-title" target="_blank" rel="noopener">
          <img class="favicon" src="https://www.google.com/s2/favicons?domain=naurok.com.ua" alt="">
          <span></span>
          <div class="tooltip">–ù–∞ –£—Ä–æ–∫ ‚Äî —Ç–µ—Å—Ç–∏</div>
        </a>
        <div class="result-url">naurok.com.ua (—Ç–µ—Å—Ç–∏)</div>
        <div class="result-desc">–¢–µ—Å—Ç–∏ –Ω–∞ ¬´–ù–∞ –£—Ä–æ–∫¬ª</div>
        <span class="favorite-star" data-id="naurokTests">‚òÜ</span>
      </div>
      <div class="result-item" id="item-vseosvita">
        <a href="#" class="result-title" target="_blank" rel="noopener">
          <img class="favicon" src="https://www.google.com/s2/favicons?domain=vseosvita.ua" alt="">
          <span></span>
          <div class="tooltip">–í—Å–µ–æ—Å–≤—ñ—Ç–∞ ‚Äî –º–µ—Ç–æ–¥–∏—á–Ω—ñ –º–∞—Ç–µ—Ä—ñ–∞–ª–∏</div>
        </a>
        <div class="result-url">vseosvita.ua</div>
        <div class="result-desc">–ú–∞—Ç–µ—Ä—ñ–∞–ª–∏ –Ω–∞ ¬´–í—Å–µ–æ—Å–≤—ñ—Ç–∞¬ª</div>
        <span class="favorite-star" data-id="vseosvita">‚òÜ</span>
      </div>

      <!-- Kahoot + Quizlet -->
      <div class="result-item" id="item-kahoot">
        <a href="#" class="result-title" target="_blank" rel="noopener">
          <img class="favicon" src="https://www.google.com/s2/favicons?domain=kahoot.com" alt="">
          <span></span>
          <div class="tooltip">Kahoot! ‚Äî —ñ–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ñ –≤—ñ–∫—Ç–æ—Ä–∏–Ω–∏</div>
        </a>
        <div class="result-url">kahoot.com</div>
        <div class="result-desc">–Ü–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ñ –≤—ñ–∫—Ç–æ—Ä–∏–Ω–∏ –¥–ª—è –∫–ª–∞—Å—É</div>
        <span class="favorite-star" data-id="kahoot">‚òÜ</span>
      </div>
      <div class="result-item" id="item-quizlet">
        <a href="#" class="result-title" target="_blank" rel="noopener">
          <img class="favicon" src="https://www.google.com/s2/favicons?domain=quizlet.com" alt="">
          <span></span>
          <div class="tooltip">Quizlet ‚Äî –∫–∞—Ä—Ç–∫–∏, –≤–∏–≤—á–µ–Ω–Ω—è —Å–ª—ñ–≤</div>
        </a>
        <div class="result-url">quizlet.com</div>
        <div class="result-desc">–ö–∞—Ä—Ç–∫–∏, –≤–ø—Ä–∞–≤–∏, —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è</div>
        <span class="favorite-star" data-id="quizlet">‚òÜ</span>
      </div>

      <!-- ClassTools -->
      <div class="result-item" id="item-classtools">
        <a href="#" class="result-title" target="_blank" rel="noopener">
          <img class="favicon" src="https://www.google.com/s2/favicons?domain=classtools.net" alt="">
          <span></span>
          <div class="tooltip">ClassTools.net ‚Äî –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∏ —ñ–≥–æ—Ä (Arcade, Timeline —Ç–æ—â–æ)</div>
        </a>
        <div class="result-url">classtools.net</div>
        <div class="result-desc">–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∏ —ñ–≥–æ—Ä, –¥—ñ–∞–≥—Ä–∞–º, —Ç–∞–π–º–ª–∞–π–Ω—ñ–≤</div>
        <span class="favorite-star" data-id="classtools">‚òÜ</span>
      </div>
    </div>

    <!-- –í—ñ–¥–µ–æ-—Å–µ–∫—Ü—ñ—è -->
    <div class="results-section">
      <div class="video-section" id="video-section">
        <div class="section-title">–í—ñ–¥–µ–æ</div>

        <div class="result-item" id="item-islcollective-videos">
          <a href="#" class="result-title" target="_blank" rel="noopener">
            <img class="favicon" src="https://www.google.com/s2/favicons?domain=islcollective.com" alt="">
            <span></span>
            <div class="tooltip">ISL Collective Videos ‚Äî —ñ–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ñ –≤—ñ–¥–µ–æ—É—Ä–æ–∫–∏</div>
          </a>
          <div class="result-url">islcollective.com/video</div>
          <div class="result-desc">–Ü–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ñ –≤—ñ–¥–µ–æ—É—Ä–æ–∫–∏ –∑ –∑–∞–≤–¥–∞–Ω–Ω—è–º–∏</div>
          <span class="favorite-star" data-id="islcollectiveVideos">‚òÜ</span>
        </div>
        <div class="result-item" id="item-youtube">
          <a href="#" class="result-title" target="_blank" rel="noopener">
            <img class="favicon" src="https://www.google.com/s2/favicons?domain=youtube.com" alt="">
            <span></span>
            <div class="tooltip">YouTube ‚Äî –Ω–∞–≤—á–∞–ª—å–Ω—ñ –≤—ñ–¥–µ–æ</div>
          </a>
          <div class="result-url">youtube.com</div>
          <div class="result-desc">–ù–∞–≤—á–∞–ª—å–Ω—ñ –≤—ñ–¥–µ–æ –Ω–∞ YouTube</div>
          <span class="favorite-star" data-id="youtube">‚òÜ</span>
        </div>
      </div>
    </div>
  </div>

  <footer>
    –ê–≤—Ç–æ—Ä: <a href="https://codenamexxv.github.io/teacher/" target="_blank" rel="noopener">–Ü–≥–æ—Ä –®—É–ª—è–∫</a><br>
    &copy; 2026
  </footer>

  <script>
    // === Debounce utility ===
    function debounce(func, wait) {
      let timeout;
      return function executedFunction(...args) {
        const later = () => {
          clearTimeout(timeout);
          func(...args);
        };
        clearTimeout(timeout);
        timeout = setTimeout(later, wait);
      };
    }

    // === DOM Elements ===
    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    let recognition = null;
    const voiceBtn = document.getElementById('voiceBtn');
    const googleBtn = document.getElementById('googleBtn');
    const input = document.getElementById('keywords');
    const header = document.getElementById('header');
    const searchWrapper = document.getElementById('searchWrapper');
    const calculatorResult = document.getElementById('calculatorResult');
    const recentSection = document.getElementById('recent-section');
    const recentList = document.getElementById('recent-list');
    const favoritesSection = document.getElementById('favorites-section');
    const favoritesList = document.getElementById('favorites-list');

    // === Platform items ===
    const mainItems = {
      wordwall: document.getElementById('item-wordwall'),
      liveworksheets: document.getElementById('item-liveworksheets'),
      islcollectiveWorksheets: document.getElementById('item-islcollective-worksheets'),
      learningapps: document.getElementById('item-learningapps'),
      naurokPresentations: document.getElementById('item-naurok-presentations'),
      naurokTests: document.getElementById('item-naurok-tests'),
      vseosvita: document.getElementById('item-vseosvita'),
      kahoot: document.getElementById('item-kahoot'),
      quizlet: document.getElementById('item-quizlet'),
      classtools: document.getElementById('item-classtools')
    };

    const videoItems = {
      islcollectiveVideos: document.getElementById('item-islcollective-videos'),
      youtube: document.getElementById('item-youtube')
    };

    const videoSection = document.getElementById('video-section');

    // === Helper: build URL for platform ===
    function buildPlatformUrl(platformId, query) {
      const encodedForGoogle = encodeURIComponent(query);
      const plusFormat = query.replace(/\s+/g, '+');

      switch (platformId) {
        case 'classtools':
          return 'https://www.classtools.net/_SEARCH/index.php';

        case 'kahoot':
          return `https://kahoot.com/search/?t=${plusFormat}&post_type=`;

        case 'quizlet':
          const spaceEncoded = query.replace(/\s+/g, '%20');
          return `https://quizlet.com/search?query=${spaceEncoded}`;

        case 'wordwall':
          // ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–µ —Ñ–æ—Ä–º—É–≤–∞–Ω–Ω—è slug –∑ –∫–∏—Ä–∏–ª–∏—Ü–µ—é
          const slug = query.trim().replace(/\s+/g, '-').replace(/^-+|-+$/g, '');
          return `https://wordwall.net/uk-ua/community/${slug}`;

        case 'liveworksheets':
          return `https://www.liveworksheets.com/search-worksheets?keys=${encodedForGoogle}`;

        case 'islcollectiveWorksheets':
          return `https://en.islcollective.com/english-esl-worksheets/search/${plusFormat}`;

        case 'learningapps':
          return `https://learningapps.org/index.php?s=${encodedForGoogle}`;

        case 'naurokPresentations':
          return `https://naurok.com.ua/biblioteka/typ-17?q=${encodedForGoogle}`;

        case 'naurokTests':
          return `https://naurok.com.ua/test?q=${encodedForGoogle}`;

        case 'vseosvita':
          return `https://vseosvita.ua/library?s=${encodedForGoogle}&cat=&is_pay=0&is_ai=&status_show=&order=3&page=&quest_type=&type_control=&id_folder=&class=&type=&title_only=`;

        case 'islcollectiveVideos':
          return `https://en.islcollective.com/english-esl-video-lessons/search/${plusFormat}`;

        case 'youtube':
          return `https://www.youtube.com/results?search_query=${plusFormat}`;

        default:
          return '#';
      }
    }

    // === Voice Recognition ===
    if (SpeechRecognition) {
      recognition = new SpeechRecognition();
      recognition.lang = 'uk-UA';
      recognition.continuous = false;
      recognition.interimResults = false;
      recognition.maxAlternatives = 1;

      let stopTimeout = null;

      recognition.onresult = (event) => {
        const transcript = event.results[0][0].transcript;
        input.value = transcript;
        debouncedUpdate();
        saveRecentQuery(transcript);
        updateVoiceButton();
      };

      recognition.onerror = (event) => {
        console.error('–ü–æ–º–∏–ª–∫–∞:', event.error);
        stopRecording();
      };

      recognition.onend = () => {
        if (stopTimeout) clearTimeout(stopTimeout);
        stopRecording();
      };
    }

    function startVoiceInput() {
      if (!recognition) {
        alert('–í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø—ñ–¥—Ç—Ä–∏–º—É—î –≥–æ–ª–æ—Å–æ–≤–µ –≤–≤–µ–¥–µ–Ω–Ω—è. –°–ø—Ä–æ–±—É–π—Ç–µ Chrome –∞–±–æ Edge.');
        return;
      }

      if (voiceBtn.classList.contains('recording')) {
        recognition.stop();
      } else {
        voiceBtn.textContent = '‚èπ';
        voiceBtn.classList.add('recording');
        recognition.start();

        stopTimeout = setTimeout(() => {
          recognition.stop();
        }, 4000);
      }
    }

    function stopRecording() {
      voiceBtn.classList.remove('recording');
      voiceBtn.textContent = 'üéôÔ∏è';
      if (stopTimeout) clearTimeout(stopTimeout);
    }

    // === –ú—ñ–∫—Ä–æ—Ñ–æ–Ω / ‚ùå –∫–Ω–æ–ø–∫–∞ ===
    function updateVoiceButton() {
      const isEmpty = input.value.trim() === '';
      if (isEmpty) {
        voiceBtn.textContent = 'üéôÔ∏è';
        voiceBtn.title = '–ì–æ–ª–æ—Å–æ–≤–µ –≤–≤–µ–¥–µ–Ω–Ω—è';
        voiceBtn.onclick = startVoiceInput;
      } else {
        voiceBtn.textContent = '‚ùå';
        voiceBtn.title = '–û—á–∏—Å—Ç–∏—Ç–∏ –ø–æ–ª–µ';
        voiceBtn.onclick = () => {
          input.value = '';
          updateVoiceButton();
          updateResultsNow();
          input.focus();
        };
      }
      if (voiceBtn.classList.contains('recording')) {
        stopRecording();
      }
    }

    // === Google Search ===
    function searchInGoogle() {
      const query = input.value.trim();
      if (query) {
        const url = `https://www.google.com/search?q=${encodeURIComponent(query)}`;
        window.open(url, '_blank', 'noopener,noreferrer');
      } else {
        window.open('https://www.google.com', '_blank', 'noopener,noreferrer');
      }
    }

    googleBtn.addEventListener('click', searchInGoogle);

    // === Enter Key Handling ===
    input.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') {
        e.preventDefault();
        const value = input.value.trim();
        if (value && isMathExpression(value)) {
          const result = safeEvaluate(value);
          if (result !== null) {
            updateResultsNow();
            return;
          }
        }
        searchInGoogle();
      }
    });

    // === Show/hide Recent on focus/blur ===
    input.addEventListener('focus', () => {
      if (JSON.parse(localStorage.getItem('eduSearchRecents') || '[]').length > 0) {
        recentSection.classList.add('visible');
      }
      updateVoiceButton();
    });

    input.addEventListener('blur', () => {
      setTimeout(() => {
        if (!recentList.contains(document.activeElement)) {
          recentSection.classList.remove('visible');
        }
      }, 200);
      updateVoiceButton();
    });

    // === Input handling ===
    input.addEventListener('input', () => {
      updateVoiceButton();
      debouncedUpdate();
    });

    // === Math Functions ===
    function isOnlyAddition(expr) {
      const clean = expr.trim().replace(/\s+/g, '');
      if (!clean.includes('+')) return false;
      if (/[-*/()]/.test(clean)) return false;
      const parts = clean.split('+');
      return parts.every(part => part !== '' && !isNaN(parseFloat(part)) && isFinite(parseFloat(part)));
    }

    function extractNumbersFromAddition(expr) {
      const clean = expr.trim().replace(/\s+/g, '');
      return clean.split('+').map(s => parseFloat(s));
    }

    function isMathExpression(str) {
      const trimmed = str.trim();
      if (!trimmed) return false;
      if (!/\d/.test(trimmed)) return false;
      if (!/^[\d\s+\-*/().]+$/.test(trimmed)) return false;
      if (/^[*/+]|\+$|[\-*/+)]$/.test(trimmed)) return false;
      if (/[\-+*/]{2,}/.test(trimmed.replace(/\(\s*-/g, ''))) return false;
      return true;
    }

    function safeEvaluate(expr) {
      try {
        const result = new Function('return (' + expr + ')')();
        if (typeof result === 'number' && isFinite(result)) {
          return result;
        }
      } catch (e) {
        return null;
      }
      return null;
    }

    // === Tooltip Logic ===
    document.querySelectorAll('.result-title').forEach(link => {
      const tooltip = link.querySelector('.tooltip');
      link.addEventListener('mouseenter', () => {
        tooltip.classList.add('visible');
      });
      link.addEventListener('mouseleave', () => {
        tooltip.classList.remove('visible');
      });
    });

    // === Favorites ===
    function loadFavorites() {
      const favs = JSON.parse(localStorage.getItem('eduSearchFavorites') || '[]');
      renderFavorites(favs);
    }

    function saveFavorite(platformId, query) {
      let favs = JSON.parse(localStorage.getItem('eduSearchFavorites') || '[]');
      const existingIndex = favs.findIndex(f => f.platform === platformId && f.query === query);
      if (existingIndex === -1) {
        favs.push({ platform: platformId, query, timestamp: Date.now() });
        if (favs.length > 20) favs.shift();
      }
      localStorage.setItem('eduSearchFavorites', JSON.stringify(favs));
      renderFavorites(favs);
      saveRecentQuery(query);
    }

    function removeFavorite(index) {
      let favs = JSON.parse(localStorage.getItem('eduSearchFavorites') || '[]');
      favs.splice(index, 1);
      localStorage.setItem('eduSearchFavorites', JSON.stringify(favs));
      renderFavorites(favs);
    }

    function renderFavorites(favs) {
      favoritesList.innerHTML = '';
      if (favs.length === 0) {
        favoritesSection.classList.remove('visible');
        return;
      }
      favoritesSection.classList.add('visible');
      const visibleFavs = favs.slice(-10).reverse();
      visibleFavs.forEach((fav, idx) => {
        const realIdx = favs.length - 1 - idx;
        const el = document.createElement('div');
        el.className = 'favorite-item';
        el.innerHTML = `
          ${fav.query} ‚Üí ${fav.platform}
          <span class="delete-fav" data-index="${realIdx}">üóô</span>
        `;
        el.title = `Click to go to "${fav.query}" on ${fav.platform}`;
        el.addEventListener('click', (e) => {
          if (e.target.classList.contains('delete-fav')) return;
          const url = buildPlatformUrl(fav.platform, fav.query);
          if (url !== '#') {
            window.open(url, '_blank', 'noopener,noreferrer');
            saveRecentQuery(fav.query);
          }
        });
        favoritesList.appendChild(el);
      });

      document.querySelectorAll('.delete-fav').forEach(btn => {
        btn.addEventListener('click', (e) => {
          e.stopPropagation();
          const idx = parseInt(btn.dataset.index, 10);
          removeFavorite(idx);
        });
      });
    }

    // Attach favorite stars
    document.querySelectorAll('.favorite-star').forEach(star => {
      star.addEventListener('click', (e) => {
        e.stopPropagation();
        const platformId = star.dataset.id;
        const query = input.value.trim();
        if (!query) return;
        star.classList.toggle('filled');
        if (star.classList.contains('filled')) {
          saveFavorite(platformId, query);
        }
      });
    });

    // === Recent Queries ===
    function saveRecentQuery(query) {
      if (!query) return;
      let recents = JSON.parse(localStorage.getItem('eduSearchRecents') || '[]');
      recents = recents.filter(q => q !== query);
      recents.unshift(query);
      if (recents.length > 10) recents.pop();
      localStorage.setItem('eduSearchRecents', JSON.stringify(recents));
      renderRecents(recents);
    }

    function removeRecentQuery(index) {
      let recents = JSON.parse(localStorage.getItem('eduSearchRecents') || '[]');
      recents.splice(index, 1);
      localStorage.setItem('eduSearchRecents', JSON.stringify(recents));
      renderRecents(recents);
      recentSection.classList.toggle('visible', recents.length > 0);
    }

    function renderRecents(recents) {
      recentList.innerHTML = '';
      if (recents.length === 0) {
        recentSection.classList.remove('visible');
        return;
      }
      recents.forEach((q, idx) => {
        const el = document.createElement('div');
        el.className = 'recent-item';
        el.innerHTML = `${q}<span class="delete-recent" data-index="${idx}">üóô</span>`;
        el.onclick = (e) => {
          if (e.target.classList.contains('delete-recent')) return;
          input.value = q;
          debouncedUpdate();
          input.focus();
          updateVoiceButton();
        };
        recentList.appendChild(el);
      });

      document.querySelectorAll('.delete-recent').forEach(btn => {
        btn.addEventListener('click', (e) => {
          e.stopPropagation();
          const idx = parseInt(btn.dataset.index, 10);
          removeRecentQuery(idx);
        });
      });
    }

    function loadRecents() {
      const recents = JSON.parse(localStorage.getItem('eduSearchRecents') || '[]');
      renderRecents(recents);
    }

    // === Main Update Function ===
    function updateResultsNow() {
      const value = input.value.trim();
      if (!value) {
        header.classList.remove('hidden');
        searchWrapper.classList.remove('lifted');
        calculatorResult.classList.remove('visible');
        for (const item of Object.values(mainItems)) item.classList.remove('visible');
        for (const item of Object.values(videoItems)) item.classList.remove('visible');
        videoSection.classList.remove('visible');
        return;
      }

      if (isMathExpression(value)) {
        const result = safeEvaluate(value);
        if (result !== null) {
          header.classList.add('hidden');
          searchWrapper.classList.add('lifted');

          let displayText = `${value} = ${result}`;
          let averageLine = '';

          if (isOnlyAddition(value)) {
            const numbers = extractNumbersFromAddition(value);
            const sum = numbers.reduce((a, b) => a + b, 0);
            const avg = sum / numbers.length;
            const avgRounded = avg % 1 === 0 ? avg : parseFloat(avg.toFixed(2));
            averageLine = `<div class="average-hint">–°–µ—Ä–µ–¥–Ω—î: ${avgRounded}</div>`;
          }

          calculatorResult.innerHTML = displayText + averageLine;
          calculatorResult.classList.add('visible');

          for (const item of Object.values(mainItems)) item.classList.remove('visible');
          for (const item of Object.values(videoItems)) item.classList.remove('visible');
          videoSection.classList.remove('visible');
          return;
        }
      }

      // –ó–≤–∏—á–∞–π–Ω–∏–π –ø–æ—à—É–∫
      header.classList.add('hidden');
      searchWrapper.classList.add('lifted');
      calculatorResult.classList.remove('visible');

      const platforms = [
        { id: 'wordwall', elem: mainItems.wordwall },
        { id: 'liveworksheets', elem: mainItems.liveworksheets },
        { id: 'islcollectiveWorksheets', elem: mainItems.islcollectiveWorksheets },
        { id: 'learningapps', elem: mainItems.learningapps },
        { id: 'naurokPresentations', elem: mainItems.naurokPresentations },
        { id: 'naurokTests', elem: mainItems.naurokTests },
        { id: 'vseosvita', elem: mainItems.vseosvita },
        { id: 'kahoot', elem: mainItems.kahoot },
        { id: 'quizlet', elem: mainItems.quizlet },
        { id: 'classtools', elem: mainItems.classtools },
        { id: 'islcollectiveVideos', elem: videoItems.islcollectiveVideos },
        { id: 'youtube', elem: videoItems.youtube }
      ];

      platforms.forEach(({ id, elem }) => {
        const span = elem.querySelector('.result-title span');
        const link = elem.querySelector('.result-title');
        const url = buildPlatformUrl(id, value);
        let titleText = `"${value}"`;

        if (id === 'naurokPresentations') titleText += ' ‚Äî –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü—ñ—ó –Ω–∞ ¬´–ù–∞ –£—Ä–æ–∫¬ª';
        else if (id === 'naurokTests') titleText += ' ‚Äî —Ç–µ—Å—Ç–∏ –Ω–∞ ¬´–ù–∞ –£—Ä–æ–∫¬ª';
        else if (id === 'islcollectiveVideos') titleText += ' —ñ–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ñ –≤—ñ–¥–µ–æ –Ω–∞ ISL';
        else if (id === 'youtube') titleText += ' –Ω–∞ YouTube';
        else if (id === 'classtools') titleText += ' –Ω–∞ ClassTools.net';
        else if (id === 'kahoot') titleText += ' –Ω–∞ Kahoot!';
        else if (id === 'quizlet') titleText += ' –Ω–∞ Quizlet';
        else titleText += ` –Ω–∞ ${id.charAt(0).toUpperCase() + id.slice(1).replace(/([A-Z])/g, ' $1').trim()}`;

        span.textContent = titleText;
        link.href = url;

        link.onclick = (e) => {
          e.preventDefault();
          window.open(url, '_blank', 'noopener,noreferrer');
          saveRecentQuery(value);
        };
      });

      for (const item of Object.values(mainItems)) item.classList.add('visible');
      for (const item of Object.values(videoItems)) item.classList.add('visible');
      videoSection.classList.add('visible');
    }

    const debouncedUpdate = debounce(updateResultsNow, 600);

    // Initialize
    loadRecents();
    loadFavorites();
    updateVoiceButton();
  </script>
</body>
</html>
